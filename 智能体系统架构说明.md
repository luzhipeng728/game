# è‹ä¸¹çš„æ¸¸æˆ - æ–°æ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **æ¨¡å—åŒ–**: æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹å°è£…åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­
2. **å¯æ‰©å±•**: è½»æ¾æ·»åŠ æ–°çš„æ™ºèƒ½ä½“ç±»å‹
3. **è‡ªåŠ¨åŒ–**: æ™ºèƒ½ä½“è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°
4. **é…ç½®åŒ–**: åœºæ™¯é…ç½®ä¸ä»£ç åˆ†ç¦»
5. **çµæ´»æ€§**: æ”¯æŒåŠ¨æ€æ·»åŠ /ç§»é™¤æ™ºèƒ½ä½“

## ğŸ“ æ–‡ä»¶ç»“æ„

```
sultans_game/agents/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å¯¼å…¥
â”œâ”€â”€ base_agent.py              # åŸºç¡€æ™ºèƒ½ä½“ç±»
â”œâ”€â”€ agent_registry.py          # æ™ºèƒ½ä½“æ³¨å†Œç³»ç»Ÿ
â”œâ”€â”€ scene_config.py            # åœºæ™¯é…ç½®ç³»ç»Ÿ
â”œâ”€â”€ agent_manager.py           # æ™ºèƒ½ä½“ç®¡ç†å™¨
â”œâ”€â”€ follower_agent.py          # éšä»æ™ºèƒ½ä½“
â”œâ”€â”€ courtesan_agent.py         # å¦“å¥³æ™ºèƒ½ä½“
â”œâ”€â”€ madam_agent.py             # è€é¸¨æ™ºèƒ½ä½“
â”œâ”€â”€ narrator_agent.py          # æ—ç™½æ™ºèƒ½ä½“
â””â”€â”€ merchant_agent.py          # å•†äººæ™ºèƒ½ä½“ï¼ˆç¤ºä¾‹ï¼‰
```

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

### 1. BaseGameAgent (åŸºç¡€æ™ºèƒ½ä½“ç±»)
- æ‰€æœ‰æ™ºèƒ½ä½“çš„æŠ½è±¡åŸºç±»
- å®šä¹‰é€šç”¨æ¥å£å’Œå±æ€§
- æä¾›å·¥å…·ç®¡ç†å’Œè§’è‰²å±æ€§å¤„ç†

### 2. AgentRegistry (æ™ºèƒ½ä½“æ³¨å†Œè¡¨)
- è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ™ºèƒ½ä½“ç±»
- æä¾›æ™ºèƒ½ä½“åˆ›å»ºå’ŒæŸ¥è¯¢æ¥å£
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œ

### 3. SceneConfigManager (åœºæ™¯é…ç½®ç®¡ç†å™¨)
- ç®¡ç†ä¸åŒåœºæ™¯çš„æ™ºèƒ½ä½“é…ç½®
- æ”¯æŒè‡ªå®šä¹‰åœºæ™¯åˆ›å»º
- æä¾›åœºæ™¯ä¿¡æ¯æŸ¥è¯¢æ¥å£

### 4. AgentManager (æ™ºèƒ½ä½“ç®¡ç†å™¨)
- æ ¹æ®åœºæ™¯é…ç½®åˆ›å»ºæ™ºèƒ½ä½“
- ç®¡ç†æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸ
- åè°ƒæ™ºèƒ½ä½“å¯¹è¯å’Œäº¤äº’

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨æµç¨‹

```python
from sultans_game.agents import AgentManager
from sultans_game.models import GameState

# 1. åˆ›å»ºæ™ºèƒ½ä½“ç®¡ç†å™¨
agent_manager = AgentManager()

# 2. è®¾ç½®æ¸¸æˆçŠ¶æ€
game_state = GameState()
agent_manager.set_game_state(game_state)

# 3. è®¾ç½®åœºæ™¯ï¼ˆè‡ªåŠ¨åˆ›å»ºæ™ºèƒ½ä½“ï¼‰
agent_manager.setup_scene("brothel")

# 4. è¿è¡Œåœºæ™¯å¯¹è¯
result = agent_manager.run_scene_conversation(card)
```

### æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯

```python
from sultans_game.agents import agent_registry, scene_config_manager

# æŸ¥çœ‹å¯ç”¨æ™ºèƒ½ä½“ç±»å‹
print(agent_registry.get_all_agent_types())

# æŸ¥çœ‹å¯ç”¨åœºæ™¯
print(scene_config_manager.get_all_scene_names())

# è·å–åœºæ™¯è¯¦ç»†ä¿¡æ¯
info = scene_config_manager.get_scene_info("brothel")
```

## â• æ·»åŠ æ–°æ™ºèƒ½ä½“

### æ­¥éª¤1: åˆ›å»ºæ™ºèƒ½ä½“ç±»æ–‡ä»¶

åˆ›å»º `sultans_game/agents/your_agent.py`:

```python
from crewai import Agent
from .base_agent import BaseGameAgent

class YourAgent(BaseGameAgent):
    agent_type = "your_type"
    display_name = "ä½ çš„æ™ºèƒ½ä½“"
    description = "æ™ºèƒ½ä½“æè¿°"
    required_tools = ["dialogue", "scene_control"]
    
    def get_role(self) -> str:
        return f"è§’è‰²åç§° - {self.character.name}"
    
    def get_goal(self) -> str:
        return "æ™ºèƒ½ä½“ç›®æ ‡"
    
    def get_backstory(self) -> str:
        return "æ™ºèƒ½ä½“èƒŒæ™¯æ•…äº‹"
    
    def _create_agent(self) -> Agent:
        return Agent(
            role=self.get_role(),
            goal=self.get_goal(),
            backstory=self.get_backstory(),
            tools=self.get_tools(),
            llm=self.llm,
            verbose=True,
            allow_delegation=False,
            memory=True
        )
```

### æ­¥éª¤2: ç³»ç»Ÿè‡ªåŠ¨æ³¨å†Œ

æ™ºèƒ½ä½“ä¼šè¢«è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ï¼

### æ­¥éª¤3: åœ¨åœºæ™¯ä¸­ä½¿ç”¨

```python
# åˆ›å»ºè‡ªå®šä¹‰åœºæ™¯
scene_config_manager.create_custom_scene(
    scene_name="custom_scene",
    description="è‡ªå®šä¹‰åœºæ™¯",
    location="æŸä¸ªä½ç½®",
    atmosphere="æŸç§æ°›å›´",
    agent_configs=[
        {
            "agent_type": "your_type",
            "character_name": "è§’è‰²å",
            "role_name": "è§’è‰²",
            "required": True
        }
    ]
)
```

## ğŸ® é¢„å®šä¹‰åœºæ™¯

### brothel (å¦“é™¢åœºæ™¯)
- **æ™ºèƒ½ä½“**: narrator, follower, courtesan, madam
- **é€‚ç”¨äº**: ç¤¾äº¤ã€è°æŠ¥ã€è¯±æƒ‘ç±»å¡ç‰Œ

### market (å¸‚åœºåœºæ™¯)
- **æ™ºèƒ½ä½“**: narrator, follower
- **é€‚ç”¨äº**: è´¸æ˜“ã€ä¿¡æ¯æ”¶é›†ç±»å¡ç‰Œ

### palace (å®«å»·åœºæ™¯)
- **æ™ºèƒ½ä½“**: narrator, follower
- **é€‚ç”¨äº**: æƒè°‹ã€æ”¿æ²»ç±»å¡ç‰Œ

## ğŸ”§ é«˜çº§åŠŸèƒ½

### åŠ¨æ€æ™ºèƒ½ä½“ç®¡ç†

```python
# å‘åœºæ™¯æ·»åŠ æ™ºèƒ½ä½“
agent_manager.add_agent_to_scene("merchant", character)

# ä»åœºæ™¯ç§»é™¤æ™ºèƒ½ä½“
agent_manager.remove_agent_from_scene("merchant")
```

### è‡ªå®šä¹‰åœºæ™¯é…ç½®

```python
# ä¿å­˜åœºæ™¯é…ç½®åˆ°æ–‡ä»¶
scene_config_manager.save_to_file("scenes.json")

# ä»æ–‡ä»¶åŠ è½½åœºæ™¯é…ç½®
scene_config_manager.load_from_file("scenes.json")
```

## ğŸ¯ ä¼˜åŠ¿

1. **æ˜“äºæ‰©å±•**: æ·»åŠ æ–°æ™ºèƒ½ä½“åªéœ€åˆ›å»ºä¸€ä¸ªæ–‡ä»¶
2. **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨æ³¨å†Œæˆ–é…ç½®
3. **çµæ´»é…ç½®**: åœºæ™¯å’Œæ™ºèƒ½ä½“é…ç½®åˆ†ç¦»
4. **ç±»å‹å®‰å…¨**: å¼ºç±»å‹æ£€æŸ¥å’Œæ¥å£çº¦æŸ
5. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†å’ŒèŒè´£åˆ†ç¦»

## ğŸ“ æ³¨æ„äº‹é¡¹

1. æ–°æ™ºèƒ½ä½“æ–‡ä»¶å¿…é¡»ä»¥ `_agent.py` ç»“å°¾
2. æ™ºèƒ½ä½“ç±»å¿…é¡»ç»§æ‰¿è‡ª `BaseGameAgent`
3. å¿…é¡»è®¾ç½® `agent_type` ç±»å±æ€§
4. åœºæ™¯é…ç½®ä¸­çš„æ™ºèƒ½ä½“ç±»å‹å¿…é¡»å·²æ³¨å†Œ

## ğŸ”® æœªæ¥æ‰©å±•

- æ”¯æŒæ™ºèƒ½ä½“é—´çš„ç›´æ¥é€šä¿¡
- æ™ºèƒ½ä½“çŠ¶æ€æŒä¹…åŒ–
- æ›´å¤æ‚çš„åœºæ™¯è½¬æ¢é€»è¾‘
- æ™ºèƒ½ä½“èƒ½åŠ›å’ŒæŠ€èƒ½ç³»ç»Ÿ
- åŠ¨æ€åœºæ™¯ç”Ÿæˆ 